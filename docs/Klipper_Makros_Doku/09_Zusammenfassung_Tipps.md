## Zusammenfassung und Tipps

Makros in Klipper ermöglichen es, komplexe Abläufe und Automatismen auf dem 3D-Drucker zu realisieren – von simplen Abkürzungen bis hin zu vollständig parametrierbaren Routinen. Durch die Integration der Jinja2-Template-Sprache können Makros je nach Situation unterschiedliche G-Codes ausführen, was eine enorme Flexibilität bietet. Bei der Arbeit mit Makros sollte man die folgenden **Tipps und Einschränkungen** im Hinterkopf behalten:

- **Makro-Auswertung vs. Ausführung:** Verständnis des Auswertungszeitpunkts ist entscheidend. Veränderungen des Druckerzustands innerhalb desselben Makros (z.B. Temperaturen, Positionen) wirken sich erst auf nachfolgende Makroaufrufe oder G-Code außerhalb des Makros aus, nicht aber auf die schon ausgewertete Logik des aktuellen Makros ([Commands templates - Klipper documentation](https://www.klipper3d.org/Command_Templates.html#:~:text=Available%20fields%20are%20defined%20in,the%20Status%20Reference%20document)). Planen Sie Bedingungen entsprechend oder nutzen Sie ggf. separate Makros für mehrstufige Abläufe.

- **Debugging:** Nutzen Sie `RESPOND`/`M117`-Ausgaben und `action_respond_info` innerhalb von Makros, um den Ablauf nachzuvollziehen. So können Sie z.B. mit `M117 Wert: {foo}` Zwischenwerte anzeigen lassen oder mit `action_raise_error` gezielt abbrechen, falls etwas Unerwartetes auftritt. Kommentare im Makro (`# ...`) helfen ebenfalls, die Logik zu dokumentieren.

- **Keine Endlosschleifen:** Da Makros direkt im Klipper-Prozess ausgewertet werden, vermeiden Sie Schleifen, die potenziell sehr groß oder endlos sind. Dies könnte Klipper blockieren. Eine `for`-Schleife über einige hundert Iterationen ist ok, aber tausende wären problematisch. Im Zweifel kann man lange Wiederholungen aufteilen oder per Firmware-Code (Python-Modul) lösen.

- **Leistung:** Aufrufe des `printer`-Objekts und einfache Rechenoperationen sind sehr schnell und belasten den Drucker nicht spürbar. Dennoch sollten extrem rechenintensive Berechnungen in Makros vermieden werden. Nutzen Sie Makros eher zur Ablaufsteuerung als für komplexe mathematische Algorithmen.

- **Sicherheit:** Makros haben vollen Zugriff auf Druckerbefehle. Seien Sie vorsichtig, was Sie automatisieren – ein falsches Bedingungsergebnis könnte z.B. zu einer unbeabsichtigten Bewegung führen. Testen Sie neue Makros schrittweise und idealerweise ohne laufenden Druck, um sicherzustellen, dass sie korrekt funktionieren.

- **Quellen und weiterführende Infos:** Die offizielle Klipper-Dokumentation enthält im Abschnitt *Commands* eine ausführliche Beschreibung der Makro-Funktionen ([Commands templates - Klipper documentation](https://www.klipper3d.org/Command_Templates.html#:~:text=The%20gcode_macro%20,further%20information%20on%20the%20syntax)) ([Commands templates - Klipper documentation](https://www.klipper3d.org/Command_Templates.html#:~:text=It%20is%20often%20useful%20to,For%20example%2C%20if%20the%20macro)). Zudem lohnt ein Blick in die mitgelieferte Datei *sample-macros.cfg* im Klipper-Repository, die viele nützliche Beispielmakros liefert ([Commands templates - Klipper documentation](https://www.klipper3d.org/Command_Templates.html#:~:text=See%20the%20sample,rawparams)). Für Moonraker gibt es eine Dokumentation der HTTP-API ([Printer Administration - Moonraker](https://moonraker.readthedocs.io/en/latest/external_api/printer/#:~:text=HTTP%20Request)) ([Printer Administration - Moonraker](https://moonraker.readthedocs.io/en/latest/external_api/printer/#:~:text=%7B%20,7466)) sowie Community-Projekte (z.B. Telegram-Bots, Home Assistant Integrationen), die praktische Makro-Anwendungsfälle zeigen. Die Jinja2-Templatesprache selbst ist auf der offiziellen Website beschrieben ([Commands templates - Klipper documentation](https://www.klipper3d.org/Command_Templates.html#:~:text=The%20gcode_macro%20,further%20information%20on%20the%20syntax)) – für tieferes Verständnis kann man dort die Syntax und weitere Filter/Test-Funktionen nachlesen.

Mit diesem Wissen ausgestattet, lassen sich Makros effektiv einsetzen – sei es, um den Druckablauf zu automatisieren (Start-, Endsequenzen, Filamentwechsel), bestimmte Hardware zu steuern (Lüfter, LEDs, Zusatzmodule) oder interaktive Funktionen für den Nutzer bereitzustellen. Durch kluges Kombinieren von Makros, Sensoren und der Host-API kann man seinen 3D-Drucker nahezu beliebig erweitern und an die eigenen Bedürfnisse anpassen. Viel Erfolg beim Erstellen eigener Makros!

**Quellen:** Klipper Dokumentation ([Commands templates - Klipper documentation](https://www.klipper3d.org/Command_Templates.html#:~:text=The%20gcode_macro%20,further%20information%20on%20the%20syntax)) ([Commands templates - Klipper documentation](https://www.klipper3d.org/Command_Templates.html#:~:text=Available%20fields%20are%20defined%20in,the%20Status%20Reference%20document)) ([Commands templates - Klipper documentation](https://www.klipper3d.org/Command_Templates.html#:~:text=The%20SET_GCODE_VARIABLE%20command%20may%20be,For%20example)) ([Commands templates - Klipper documentation](https://www.klipper3d.org/Command_Templates.html#:~:text=%5Bgcode_macro%20finish_probe%5D%20gcode%3A%20,bed_temp)), Moonraker Dokumentation ([Configuration - Moonraker](https://moonraker.readthedocs.io/en/latest/configuration/#:~:text=%5Bgcode_macro%20SHUTDOWN%5D%20gcode%3A%20%7Baction_call_remote_method%28)) ([Printer Administration - Moonraker](https://moonraker.readthedocs.io/en/latest/external_api/printer/#:~:text=%7B%20)), Mainsail Dokumentation ([Macros | Mainsail](https://docs.mainsail.xyz/overview/settings/macros#:~:text=This%20mode%20is%20very%20simple,a%20panel%20on%20the%20dashboard)) ([Macro Prompts | Mainsail](https://docs.mainsail.xyz/overview/features/macro-prompts#:~:text=Macro%20Prompts)), Annex Engineering TradRack Doku ([TradRack/docs/kalico/Customization.md at main · Annex-Engineering/TradRack · GitHub](https://github.com/Annex-Engineering/TradRack/blob/main/docs/kalico/Customization.md#:~:text=%60,these%20variables%20for%20more%20details)).